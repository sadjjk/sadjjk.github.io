<html>
<head>
  <meta charset="utf-8" />
<meta name="description" content="" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="robots" content="all,follow">
<meta name="googlebot" content="index,follow,snippet,archive">
<title>Python制作豆瓣书单分享海报(仿电影海报) | 金鱼的今语</title>
<link rel="shortcut icon" href="https://sadjjk.github.io/favicon.ico?v=1668343231821">
<link rel="stylesheet" href="https://sadjjk.github.io/styles/main.css" type='text/css' media='all'>
<link href="https://sadjjk.github.io/media/scripts/autoc.css" rel="stylesheet">

<script src="https://sadjjk.github.io/media/scripts/lib/highlight.min.js"></script>
<script src="https://sadjjk.github.io/media/scripts/lib/moment.min.js"></script>
<link href="https://sadjjk.github.io/media/scripts/katex.min.css" rel="stylesheet">



</head>
<body class="home blog ct-body standard">
<div id="overflow-container" class="overflow-container">
  <header id="site-header" class="site-header" role="banner">


    <div class="container">
        <div id="title-info" class="title-info">
            <div id='site-title' class='site-title'>
                <a href="https://sadjjk.github.io">  金鱼的今语 </a>
            </div>
        </div>
        <button id="toggle-navigation" class="toggle-navigation">
            <i class="fa fa-bars"></i>
        </button>
        <div id="menu-primary-tracks" class="menu-primary-tracks"></div>
        <div id="menu-primary" class="menu-container menu-primary" role="navigation">
            <p class="site-description">真话、假话、胡话、全都说</p>
            <div class="menu">
                <ul id="menu-primary-items" class="menu-primary-items">
                     
                        
                            <li id="menu-item" class='menu-item menu-item-type-post_type menu-item-object-page current-menu-item current_page_item'>
                                <a href="/">首页</a>
                            </li>
                        
                    
                        
                            <li id="menu-item" class='menu-item menu-item-type-post_type menu-item-object-page current-menu-item current_page_item'>
                                <a href="/archives">归档</a>
                            </li>
                        
                    
                        
                            <li id="menu-item" class='menu-item menu-item-type-post_type menu-item-object-page current-menu-item current_page_item'>
                                <a href="/tags">标签</a>
                            </li>
                        
                    
                        
                            <li id="menu-item" class='menu-item menu-item-type-post_type menu-item-object-page current-menu-item current_page_item'>
                                <a href="https://bili.wjinyu.top" target="_blank">B站视频解析</a>
                            </li>
                        
                    
                        
                            <li id="menu-item" class='menu-item menu-item-type-post_type menu-item-object-page current-menu-item current_page_item'>
                                <a href="https://video.wjinyu.top" target="_blank">今日追剧</a>
                            </li>
                        
                    
                        
                            <li id="menu-item" class='menu-item menu-item-type-post_type menu-item-object-page current-menu-item current_page_item'>
                                <a href="http://music.wjinyu.top" target="_blank">今语云音乐</a>
                            </li>
                        
                    
                        
                            <li id="menu-item" class='menu-item menu-item-type-post_type menu-item-object-page current-menu-item current_page_item'>
                                <a href="/post/about">关于</a>
                            </li>
                        
                    
                </ul>
            </div>
        </div>
    </div>


</header>


  <div id="main" class="main" role="main">
    <div id="loop-container" class="loop-container">
      <div class="post type-post status-publish format-standard has-post-thumbnail hentry category-design tag-design tag-standard-2 tag-tagalicious tag-travel entry full-without-featured odd excerpt-1">
        
          <div class='featured-image lazy lazy-bg-image' data-background="https://i.loli.net/2019/09/29/fh3KVSa8TECBIkD.png">
          </div>
        

        <div class="entry-meta">
          <span class="date">· 2019-09-29 ·</span>

          
            <span class="category">
                    <span> / </span>
                    <a href="https://sadjjk.github.io/tag/life/">Life</a>
                </span>
          
        </div>
        <div class='entry-header'>
          <h1 class='entry-title'>Python制作豆瓣书单分享海报(仿电影海报)</h1>
        </div>
        <div class="entry-container">
          <div class="entry-content">
            <article id="article">

            </article>
          </div>
        </div>
          
            <nav class="navigation pagination" role="navigation">
              <h2 class="screen-reader-text">Posts navigation</h2>
              <div class="nav-links">
                <a class="next page-numbers" style="font-size:20px" href="https://sadjjk.github.io/post/StockProject/">下一篇->股票行情面板Web</a>
              </div>
            </nav>
          
      </div>
      <section id="comments" class="comments">
        
      </section>
    </div>
  </div>
  <footer id="site-footer" class="site-footer" role="contentinfo">
    <h1>
        <a href="https://sadjjk.github.io"> 金鱼的今语 </a>
    </h1>
    <p class="site-description" style="font-size:18px">真话、假话、胡话、全都说</p>
    <div id="menu-footer" class="menu-container menu-footer" role="navigation">
        <div class="menu">
            <ul id="menu-footer-items" class="menu-footer-items">
            </ul>
        </div>
    </div>
    <ul class="social-media-icons">
        
            
                <li>
                    <a href="https://github.com/sadjjk" data-animate-hover="pulse" class="github" target="_blank">
                        <i class="fab fa-github" title="github"></i>
                        <span class="screen-reader-text">github</span>
                    </a>
                </li>
            
        
            
        
            
                <li>
                    <a href="https://weibo.com/ " data-animate-hover="pulse" class="weibo" target="_blank">
                        <i class="fab fa-weibo" title="weibo"></i>
                        <span class="screen-reader-text">weibo</span>
                    </a>
                </li>
            
        
            
                <li>
                    <a href="https://www.zhihu.com/" data-animate-hover="pulse" class="zhihu" target="_blank">
                        <i class="fab fa-zhihu" title="zhihu"></i>
                        <span class="screen-reader-text">zhihu</span>
                    </a>
                </li>
            
        
            
        
            
        
            
        
            
        
    </ul>
    <div class="design-credit">
        <p>Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a> | <a class="rss" href="/atom.xml" target="_blank">RSS</a> | <a href="https://beian.miit.gov.cn" target="_blank">&nbsp;浙ICP备2021037254号-1</a> | <img src="/post-images/gongan.png">浙公网安备 33108202000706号</p>
    </div>
</footer>

<script>
hljs.initHighlightingOnLoad()
</script>
<script src="https://sadjjk.github.io/media/scripts/lib/autoc.min.js"></script>
<script src="https://sadjjk.github.io/media/scripts/lib/jquery.min.js"></script>
<script src="https://sadjjk.github.io/media/scripts/lib/production.min.js"></script>

  <script>
    var article = `<p>Github:https://github.com/sadjjk/DoubanPoster</p>
<!--more-->
<h3 id="0x00前言">0x00前言</h3>
<p>之前看到一张 豆瓣分享海报 感觉很不错</p>
<figure data-type="image" tabindex="1"><img src="https://i.loli.net/2019/08/25/Vc72z9JuxgkKyEY.png" alt="哪吒之魔童降世.png" loading="lazy"></figure>
<p>应该是豆瓣官方的设计的 但是没找到分享的地方<br>
<em>PS:手机APP端分享的海报不是这样的</em><br>
于是就想自己用Python画一个<br>
<img src="https://i.loli.net/2019/08/25/F3vnwIjSNs6EKkM.png" alt="哪吒之魔童降世_poster.png" loading="lazy"></p>
<p>自己画的是这样的  没有阴影 没有半圆分割 字体略不同 其他基本是一样的 基本满意<br>
等实现完所有细节 自我陶醉时<br>
在豆瓣网页端找到这张官方分享海报的地方<br>
评分右上角 点击 <strong>引用</strong> 即可导出官方分享海报图<br>
当场吐血 功能白做了<br>
好在 豆瓣书单是没有引用导出海报功能<br>
临时加需求 按照电影海报的亚子 绘制书单的分享海报<br>
<img src="https://i.loli.net/2019/09/29/fh3KVSa8TECBIkD.png" alt="房思琪的初恋乐园_poster.png" loading="lazy"></p>
<h3 id="0x01-豆瓣爬虫">0x01 豆瓣爬虫</h3>
<p>豆瓣电影/书单提供了相应的官方接口 但好像不够满足海报所需的数据 比如星星数<br>
就写相应的爬虫获取相应的数据 这里不是详细阐述爬虫过程 具体见源码<br>
假设相应的数据都已获得</p>
<h3 id="0x02-开始绘图">0x02 开始绘图</h3>
<p>Python画图主要使用的是PIL<br>
二维码绘制使用 qrcode<br>
海报主要分为3部分：①区背景图、 ②区标题和描述、③区评分及详情</p>
<h4 id="0加载模板素材"><strong>0.加载模板素材</strong></h4>
<p>模板素材在imgs文件夹中<br>
一张豆瓣海报空白底版 三张不同状态的星星</p>
<pre><code class="language-python">from PIL import Image

class DouBanPoster:

    def __init__(self):
        self.template_image = Image.open('imgs/template.jpg')
        self.star_yes_image = Image.open('imgs/star_yes.jpg')
        self.star_no_image = Image.open('imgs/star_no.jpg')
        self.star_mid_image = Image.open('imgs/star_mid.jpg')
</code></pre>
<p>之后所有信息都在template_image上进行绘制添加</p>
<h4 id="1-1区背景图">1. ①区背景图</h4>
<p>自定义函数backgroundImg<br>
参数 : bgImg (type:dict)<br>
bgImgPath：背景图路径<br>
postition：粘贴位置 默认(0,0)<br>
size: 重置尺寸 默认(450,684)</p>
<p>把背景图放在在底版图上 <code>paste</code>即可</p>
<pre><code class="language-python">def backgroudImg(self,bgImg):

  bgImgPath = bgImg.get('bgImgPath')
  postition = bgImg.get('postition')
  postition = postition if postition else (0,0)
  size = bgImg.get('size')
  size = size if size else  (450,684)
  if bgImgPath:
    bg_image = Image.open(bgImgPath).resize((size[0],size[1])) #重置大小
    self.template_image.paste(bg_image, postition)

</code></pre>
<h4 id="22区标题和描述">2.②区标题和描述</h4>
<p>文本的绘制 使用<code>draw.text</code><br>
唯一要注意的是长文本<br>
标题或描述可能会过长 超出绘制区域 无法自动换行<br>
因此需要定义一个自动换行的函数<br>
所有的可能过长的文本都调用此函数<br>
自动换行功能使用textwrap.wrap<br>
它会根据width自动换行<br>
将换好的行 逐行绘制即可<br>
PS:还有一个细节 一行一行绘制<br>
累计高度可能会超过模板图片的高度<br>
因此累计高度超出模板图片高度 break退出 不在绘制文本</p>
<pre><code class="language-python"># 长文本换行
    def draw_longtext(self,draw, item_describe, postition, pad_h,font_size,width,text_color = &quot;#000000&quot;,bd=False):
        # 换行

        para = textwrap.wrap(item_describe, width=width)

        for line in para:
            w, h = draw.textsize(line, font=self.getFontSize(font_size,bd=bd))

            draw.text(postition, line, text_color, font=self.getFontSize(font_size,bd=bd))
            postition[1] += h + pad_h # 增加行间距

            # 超过模板高度 停止
            if postition[1]+ h+pad_h &gt; self.template_image.size[1]:
                break

        return  postition[1]
</code></pre>
<h4 id="33区评分及详情">3.③区评分及详情</h4>
<ul>
<li>评分数值 及评分人数 指定大小指定位置绘制即可</li>
<li>评分星星数 <code>star_rate</code> 35代表3.5颗星 40代表4颗星</li>
</ul>
<pre><code># 星星数
star_rate = str(ratedescribe.get('star_rate'))
if star_rate:
    for i in range(5):
        if i &lt; int(star_rate) // 10:
            self.template_image.paste(self.star_yes_image, (rating_people_index + i * 30, 160))
        elif str(star_rate)[1] == '5' and i == int(star_rate) // 10:
            self.template_image.paste(self.star_mid_image, (rating_people_index + i * 30, 160))
        else:
            self.template_image.paste(self.star_no_image, (rating_people_index + i * 30, 160))
</code></pre>
<ul>
<li>
<p>好于XX% XX片 依然是文本 指定大小 指定位置 指定颜色 绘制即可</p>
</li>
<li>
<p>二维码</p>
<p>使用qrcode生成地址二维码<br>
因为模板非纯白色 所以在二维码边框增加模板颜色</p>
<pre><code class="language-python"># 二维码
def make_QR(self,content, sizeW, sizeH):  # 创建二维码

  qr = qrcode.QRCode(
    version=1,
    error_correction=qrcode.constants.ERROR_CORRECT_L,
    box_size=10,
    border=4,
  )

  qr.add_data(data=content)
  qr.make(fit=True)
  img = qr.make_image(back_color=&quot;#fafbfc&quot;)
  img = img.resize((sizeW, sizeH))
  return img
</code></pre>
<p>将生成好的二维码 放在模板图片上<br>
处理逻辑和背景图一致</p>
</li>
</ul>
<h3 id="0x03-总结">0x03 总结</h3>
<p>run.py 传入豆瓣相应地址 即可一键生成海报</p>
<p>PS:因数据是按照网页结构即时抓取的 若豆瓣html相应结构发生变化 则会失效 故不保证永远有效</p>
`
    var content = article.split("<!--more-->")[1]
    if (content != null)
        document.getElementById('article').innerHTML = content;
    else
        document.getElementById('article').innerHTML = article

    let navigation = new AutocJs({
        title:'Python制作豆瓣书单分享海报(仿电影海报)',
        isGenerateOutlineChapterCode: false
    })
    </script>
</div>
</body>
</html>

