<html>
<head>
  <meta charset="utf-8" />
<meta name="description" content="" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="robots" content="all,follow">
<meta name="googlebot" content="index,follow,snippet,archive">
<title>各种常用距离及代码实现 | 金鱼的今语</title>
<link rel="shortcut icon" href="https://sadjjk.github.io/favicon.ico?v=1668343231821">
<link rel="stylesheet" href="https://sadjjk.github.io/styles/main.css" type='text/css' media='all'>
<link href="https://sadjjk.github.io/media/scripts/autoc.css" rel="stylesheet">

<script src="https://sadjjk.github.io/media/scripts/lib/highlight.min.js"></script>
<script src="https://sadjjk.github.io/media/scripts/lib/moment.min.js"></script>
<link href="https://sadjjk.github.io/media/scripts/katex.min.css" rel="stylesheet">



</head>
<body class="home blog ct-body standard">
<div id="overflow-container" class="overflow-container">
  <header id="site-header" class="site-header" role="banner">


    <div class="container">
        <div id="title-info" class="title-info">
            <div id='site-title' class='site-title'>
                <a href="https://sadjjk.github.io">  金鱼的今语 </a>
            </div>
        </div>
        <button id="toggle-navigation" class="toggle-navigation">
            <i class="fa fa-bars"></i>
        </button>
        <div id="menu-primary-tracks" class="menu-primary-tracks"></div>
        <div id="menu-primary" class="menu-container menu-primary" role="navigation">
            <p class="site-description">真话、假话、胡话、全都说</p>
            <div class="menu">
                <ul id="menu-primary-items" class="menu-primary-items">
                     
                        
                            <li id="menu-item" class='menu-item menu-item-type-post_type menu-item-object-page current-menu-item current_page_item'>
                                <a href="/">首页</a>
                            </li>
                        
                    
                        
                            <li id="menu-item" class='menu-item menu-item-type-post_type menu-item-object-page current-menu-item current_page_item'>
                                <a href="/archives">归档</a>
                            </li>
                        
                    
                        
                            <li id="menu-item" class='menu-item menu-item-type-post_type menu-item-object-page current-menu-item current_page_item'>
                                <a href="/tags">标签</a>
                            </li>
                        
                    
                        
                            <li id="menu-item" class='menu-item menu-item-type-post_type menu-item-object-page current-menu-item current_page_item'>
                                <a href="https://bili.wjinyu.top" target="_blank">B站视频解析</a>
                            </li>
                        
                    
                        
                            <li id="menu-item" class='menu-item menu-item-type-post_type menu-item-object-page current-menu-item current_page_item'>
                                <a href="https://video.wjinyu.top" target="_blank">今日追剧</a>
                            </li>
                        
                    
                        
                            <li id="menu-item" class='menu-item menu-item-type-post_type menu-item-object-page current-menu-item current_page_item'>
                                <a href="http://music.wjinyu.top" target="_blank">今语云音乐</a>
                            </li>
                        
                    
                        
                            <li id="menu-item" class='menu-item menu-item-type-post_type menu-item-object-page current-menu-item current_page_item'>
                                <a href="/post/about">关于</a>
                            </li>
                        
                    
                </ul>
            </div>
        </div>
    </div>


</header>


  <div id="main" class="main" role="main">
    <div id="loop-container" class="loop-container">
      <div class="post type-post status-publish format-standard has-post-thumbnail hentry category-design tag-design tag-standard-2 tag-tagalicious tag-travel entry full-without-featured odd excerpt-1">
        
          <div class='featured-image lazy lazy-bg-image' data-background="https://i.loli.net/2019/07/22/5d35296db88a940953.jpg">
          </div>
        

        <div class="entry-meta">
          <span class="date">· 2019-06-06 ·</span>

          
            <span class="category">
                    <span> / </span>
                    <a href="https://sadjjk.github.io/tag/work/">Work</a>
                </span>
          
        </div>
        <div class='entry-header'>
          <h1 class='entry-title'>各种常用距离及代码实现</h1>
        </div>
        <div class="entry-container">
          <div class="entry-content">
            <article id="article">

            </article>
          </div>
        </div>
          
            <nav class="navigation pagination" role="navigation">
              <h2 class="screen-reader-text">Posts navigation</h2>
              <div class="nav-links">
                <a class="next page-numbers" style="font-size:20px" href="https://sadjjk.github.io/post/mac-app-recommend/">下一篇->Mac软件推荐</a>
              </div>
            </nav>
          
      </div>
      <section id="comments" class="comments">
        
      </section>
    </div>
  </div>
  <footer id="site-footer" class="site-footer" role="contentinfo">
    <h1>
        <a href="https://sadjjk.github.io"> 金鱼的今语 </a>
    </h1>
    <p class="site-description" style="font-size:18px">真话、假话、胡话、全都说</p>
    <div id="menu-footer" class="menu-container menu-footer" role="navigation">
        <div class="menu">
            <ul id="menu-footer-items" class="menu-footer-items">
            </ul>
        </div>
    </div>
    <ul class="social-media-icons">
        
            
                <li>
                    <a href="https://github.com/sadjjk" data-animate-hover="pulse" class="github" target="_blank">
                        <i class="fab fa-github" title="github"></i>
                        <span class="screen-reader-text">github</span>
                    </a>
                </li>
            
        
            
        
            
                <li>
                    <a href="https://weibo.com/ " data-animate-hover="pulse" class="weibo" target="_blank">
                        <i class="fab fa-weibo" title="weibo"></i>
                        <span class="screen-reader-text">weibo</span>
                    </a>
                </li>
            
        
            
                <li>
                    <a href="https://www.zhihu.com/" data-animate-hover="pulse" class="zhihu" target="_blank">
                        <i class="fab fa-zhihu" title="zhihu"></i>
                        <span class="screen-reader-text">zhihu</span>
                    </a>
                </li>
            
        
            
        
            
        
            
        
            
        
    </ul>
    <div class="design-credit">
        <p>Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a> | <a class="rss" href="/atom.xml" target="_blank">RSS</a> | <a href="https://beian.miit.gov.cn" target="_blank">&nbsp;浙ICP备2021037254号-1</a> | <img src="/post-images/gongan.png">浙公网安备 33108202000706号</p>
    </div>
</footer>

<script>
hljs.initHighlightingOnLoad()
</script>
<script src="https://sadjjk.github.io/media/scripts/lib/autoc.min.js"></script>
<script src="https://sadjjk.github.io/media/scripts/lib/jquery.min.js"></script>
<script src="https://sadjjk.github.io/media/scripts/lib/production.min.js"></script>

  <script>
    var article = `<p>常用(数学概念)的距离和在Sklearn中的调用</p>
<!--more-->
<p>以前看到各种距离及公式</p>
<p>现在花些时间整理一下</p>
<p>Sklearn里已经内置超多距离，以前都没有发现</p>
<p>主要讲一下 距离的定义和如何代码调用</p>
<p>(大多类似文章都是公式理论讲讲 就没了  简直 no code no bb )</p>
<h3 id="用于向量空间的度量标准">用于向量空间的度量标准</h3>
<table>
<thead>
<tr>
<th>值</th>
<th>名称</th>
<th>参数</th>
<th>距离公式</th>
</tr>
</thead>
<tbody>
<tr>
<td>“euclidean”</td>
<td>欧式距离</td>
<td></td>
<td><code>sqrt(sum((x - y)^2))</code></td>
</tr>
<tr>
<td>“manhattan”</td>
<td>曼哈顿距离</td>
<td></td>
<td>`sum(</td>
</tr>
<tr>
<td>“chebyshev”</td>
<td>切比雪夫距离</td>
<td></td>
<td>`max(</td>
</tr>
<tr>
<td>“minkowski”</td>
<td>闵氏距离</td>
<td>p</td>
<td>`sum(</td>
</tr>
<tr>
<td>“seuclidean”</td>
<td>标准化欧氏距离</td>
<td>V</td>
<td><code>sqrt(sum((x - y)^2 / V))</code></td>
</tr>
<tr>
<td>“mahalanobis”</td>
<td>马氏距离</td>
<td>V或VI</td>
<td><code>sqrt((x - y)' V^-1 (x - y))</code></td>
</tr>
</tbody>
</table>
<h4 id="欧式距离">欧式距离</h4>
<p>欧氏距离是最常用的一种距离计算方法</p>
<ol>
<li>
<p>欧式距离定义</p>
<p>两个n维向量a(x11,x12,…,x1n)与 b(x21,x22,…,x2n)间的欧氏距离：</p>
<figure data-type="image" tabindex="1"><img src="https://sadjjk.github.io/post-images/5d18783098e5a62397.png" alt="" loading="lazy"></figure>
</li>
</ol>
<p>也可以用表示成向量运算的形式：</p>
<figure data-type="image" tabindex="2"><img src="https://sadjjk.github.io/post-images/5d18784f23a1256878.png" alt="" loading="lazy"></figure>
<ol start="2">
<li>
<p>Sklearn中的使用</p>
<pre><code class="language-python">from sklearn.neighbors import DistanceMetric
X = [[1, 2, 4, 6],
     [3, 5, 7, 9]]

dist = DistanceMetric.get_metric('euclidean')
dist.pairwise(X)
&gt;&gt;&gt; [[0.         5.56776436]
 	 [5.56776436 0.        ]]
'''
矩阵含义
A(1,2,4,6) 到A(1,2,4,6)的距离是0
A(1,2,4,6) 到B(3,5,7,9)的距离是5.57
B(3,5,7,9) 到A(1,2,4,6)的距离是5.57
B(3,5,7,9) 到B(3,5,7,9)的距离是0
'''
</code></pre>
</li>
</ol>
<h4 id="曼哈顿距离">曼哈顿距离</h4>
<p>曼哈顿距离也称为<strong>城市街区距离</strong>，即图中红线、黄线、蓝线的长度。</p>
<p>相当于在棋盘上从一点走到另一点，每一步都可以任意选择上下左右四个方向，所需的最短步数<br>
<img src="https://sadjjk.github.io/post-images/e850352ac65c10387a2cd556b8119313b17e89d7.jpg" alt="img" loading="lazy"></p>
<ol>
<li>
<p>曼哈顿距离的定义</p>
<p>二维平面两点a(x1,y1)与b(x2,y2)间的曼哈顿距离</p>
<figure data-type="image" tabindex="3"><img src="https://sadjjk.github.io/post-images/2011030823213652.png" alt="img" loading="lazy"></figure>
<p>两个n维向量a(x11,x12,…,x1n)与b(x21,x22,…,x2n)间的曼哈顿距离</p>
<figure data-type="image" tabindex="4"><img src="https://sadjjk.github.io/post-images/2011030823231354.png" alt="img" loading="lazy"></figure>
</li>
<li>
<p>Sklearn中的使用</p>
<pre><code class="language-python">from sklearn.neighbors import DistanceMetric
X = [[0, 0],
     [3, 5]]

dist = DistanceMetric.get_metric('manhattan')
dist.pairwise(X)
&gt;&gt;&gt; [[0. 8.]
 	   [8. 0.]]
'''
矩阵含义
A(0,0) 到A(0,0)的距离是0
A(0,0) 到B(3,5)的距离是8
B(3,5) 到A(0,0)的距离是8
B(3,5) 到B(3,5)的距离是0
'''

</code></pre>
</li>
</ol>
<h4 id="切比雪夫距离">切比雪夫距离</h4>
<p>切比雪夫距离与曼哈顿距离相似，即图中绿线。</p>
<p>相当于在棋盘上从一点走到另一点，每一步都可以任意选择东、东南、南、西南、西、西北、北、东北八个方向，所需的最短步数。<strong>比曼哈顿距离走法多了四个方向，可以斜着走。</strong></p>
<figure data-type="image" tabindex="5"><img src="https://sadjjk.github.io/post-images/e850352ac65c10387a2cd556b8119313b17e89d7.jpg" alt="img" loading="lazy"></figure>
<ol>
<li>
<p>二维平面两点a(x1,y1)与b(x2,y2)间的切比雪夫距离</p>
<figure data-type="image" tabindex="6"><img src="https://sadjjk.github.io/post-images/2011030823234117.png" alt="img" loading="lazy"></figure>
<p>两个n维向量a(x11,x12,…,x1n)与b(x21,x22,…,x2n)间的切比雪夫距离</p>
<figure data-type="image" tabindex="7"><img src="https://sadjjk.github.io/post-images/2011030823235870.png" alt="img" loading="lazy"></figure>
</li>
</ol>
<p>这个公式的另一种等价形式是</p>
<figure data-type="image" tabindex="8"><img src="https://sadjjk.github.io/post-images/2011030823242560-3692108.png" alt="img" loading="lazy"></figure>
<ol start="2">
<li>
<p>Sklearn中的使用</p>
<pre><code>from sklearn.neighbors import DistanceMetric
X = [[0, 0],
     [3, 5]]

dist = DistanceMetric.get_metric('chebyshev')
dist.pairwise(X)
&gt;&gt;&gt; [[0. 5.]
 	 [5. 0.]]
</code></pre>
</li>
</ol>
<h4 id="闵氏距离">闵氏距离</h4>
<p><strong>闵氏距离不是一种距离，而是一组距离的定义</strong>。</p>
<ol>
<li>闵氏距离的定义</li>
</ol>
<p>​       两个n维变量a(x11,x12,…,x1n)与b(x21,x22,…,x2n)间的闵可夫斯基距离定义为：</p>
<p>​     <img src="https://sadjjk.github.io/post-images/2011030823244080.png" alt="img" loading="lazy"></p>
<p>​	其中p是一个变参数。</p>
<p>​	当p=1时，就是曼哈顿距离</p>
<p>​	当p=2时，就是欧氏距离</p>
<p>​	当p→∞时，就是切比雪夫距离</p>
<p>​        根据变参数的不同，闵氏距离可以表示一类的距离。</p>
<ol start="2">
<li>
<p>Sklearn中的使用</p>
<pre><code class="language-python">from sklearn.neighbors import DistanceMetric

DistanceMetric.get_metric('minkowski', p=1) # 曼哈顿距离
DistanceMetric.get_metric('minkowski', p=2) # 欧氏距离
DistanceMetric.get_metric('minkowski', p=3)
</code></pre>
</li>
</ol>
<h4 id="标准化欧式距离">标准化欧式距离</h4>
<ol>
<li>
<p>标准欧氏距离的定义</p>
<p>标准化欧氏距离是针对简单欧氏距离的缺点而作的一种改进方案。标准欧氏距离的思路：既然数据各维分量的分布不一样，那标准化到一样。因此样本集的标准化过程(standardization)用公式描述就是：</p>
<figure data-type="image" tabindex="9"><img src="https://sadjjk.github.io/post-images/2011030823264688.png" alt="img" loading="lazy"></figure>
<p>标准化后的值 =  ( 标准化前的值  － 分量的均值 ) /分量的标准差</p>
<p>经过简单的推导就可以得到两个n维向量a(https://sadjjk.github.io/post-images/2011030823272054.png)</p>
<p><strong>标准化欧式距离与量纲无关。这其实等价于先对X矩阵进行标准化，再进行欧式距离</strong></p>
<p>实际使用过程，一般不使用标准化欧式</p>
</li>
<li>
<p>Sklearn中的使用</p>
<p>之前的表格中有写到标准化欧式距离需要参数V ,这个V是什么，V指的是各个分量的标准差(列表)</p>
<pre><code class="language-python">from sklearn.neighbors import DistanceMetric
import numpy as np 

&quot;&quot;&quot;
假设所有样本中的两个分量的标准差分别为0.5和1
计算其中三个样本(0,0)、(1,0)、(0,2)两两间的标准化欧氏距离
&quot;&quot;&quot;
X = [[0, 0],
     [1, 0],
     [0, 2]]

# 需传入参数V 即各个分量的标准差
dist = DistanceMetric.get_metric('seuclidean', V=[0.5,1])

dist.pairwise(X) 
&gt;&gt;&gt; [[0.         1.41421356 2.        ]
     [1.41421356 0.         2.44948974]
     [2.         2.44948974 0.        ]]

</code></pre>
</li>
</ol>
<h4 id="马氏距离">马氏距离</h4>
<ol>
<li>马氏距离定义</li>
</ol>
<p>​       有M个样本向量X1~Xm，协方差矩阵记为S，均值记为向量μ，则其中样本向量X到u的马氏距离表示为：</p>
<figure data-type="image" tabindex="10"><img src="https://sadjjk.github.io/post-images/2011030823274286.png" alt="img" loading="lazy"></figure>
<p>​       而其中向量Xi与Xj之间的马氏距离定义为：</p>
<figure data-type="image" tabindex="11"><img src="https://sadjjk.github.io/post-images/2011030823280193.png" alt="img" loading="lazy"></figure>
<p>​       若协方差矩阵是单位矩阵（各个样本向量之间独立同分布）,则公式就成了：</p>
<figure data-type="image" tabindex="12"><img src="https://sadjjk.github.io/post-images/2011030823281650.png" alt="img" loading="lazy"></figure>
<p>​       也就是欧氏距离了。</p>
<p>若协方差矩阵是对角矩阵，公式变成了标准化欧氏距离。</p>
<p>​       马氏距离同样与量纲无关，排除变量之间的相关性的干扰。</p>
<ol start="2">
<li>
<p>Sklearn中的使用</p>
<ul>
<li>
<p>使用条件</p>
<p>公式中有求矩阵的协方差，又求逆，又多矩阵相乘，最容易出问题的就是求逆，矩阵的求逆可能会失败</p>
<p><strong>因此能不能正常求出马氏距离，由具体数据决定，需试验。</strong></p>
</li>
<li>
<p>Code</p>
<p>之前的表格中有写到马氏距离需要参数V或VI ,这两个到底是什么。</p>
<p><strong>(这里的V和标准化欧氏距离的V，两个是完全不一样的，仅仅是参数名字相同)</strong></p>
</li>
</ul>
</li>
</ol>
<pre><code class="language-python"># 源码部分
class MahalanobisDistance(DistanceMetric):
    &quot;&quot;&quot;
    Mahalanobis Distance
    
        .. math::
           D(x, y) = \sqrt{ (x - y)^T V^{-1} (x - y) }
    
        Parameters
        ----------
        V : array_like
            Symmetric positive-definite covariance matrix.
            The inverse of this matrix will be explicitly computed.
        VI : array_like
            optionally specify the inverse directly.  If VI is passed,
            then V is not referenced.
    &quot;&quot;&quot;
    &quot;&quot;&quot; 中文(说人话)
    	V： 协方差矩阵
    	VI：协方差矩阵的逆，如果指定VI，则不使用V
    &quot;&quot;&quot;
</code></pre>
<pre><code class="language-python">from sklearn.neighbors import DistanceMetric
from numpy.linalg import inv
import numpy as np 


X = [[-1, 1, 2],
     [ 3, 4, 5],
     [ 5, 6, 8]]

# 需传入参数V 即，协方差矩阵
dist = DistanceMetric.get_metric('mahalanobis', V=np.cov(X))
# 或者参数VI 即协方差矩阵的逆
# dist = DistanceMetric.get_metric('mahalanobis', VI=inv(np.cov(X)))

dist.pairwise(X) 
&gt;&gt;&gt; [[0.00000000e+00 7.74906414e+07 1.16235962e+08]
     [7.74906414e+07 0.00000000e+00 3.87453207e+07]
     [1.16235962e+08 3.87453207e+07 0.00000000e+00]]

</code></pre>
<h3 id="用于地理空间的距离">用于地理空间的距离</h3>
<table>
<thead>
<tr>
<th>metric</th>
<th>名称</th>
<th>公式</th>
</tr>
</thead>
<tbody>
<tr>
<td>“haversine”</td>
<td>HaversineDistance</td>
<td><code>2 arcsin(sqrt(sin^2(0.5*dx) + cos(x1)cos(x2)sin^2(0.5*dy)))</code></td>
</tr>
</tbody>
</table>
<p><strong>计算纬度和经度指定的两点之间的距离</strong></p>
<pre><code class="language-python"># sklean 内置
from sklearn.neighbors import DistanceMetric
# [latitude, longitude] 纬度 经度
X = [[38.13,106.83],
     [29.99,120.23]]

dist = DistanceMetric.get_metric('haversine')
dist.pairwise(X)
&gt;&gt;&gt; [[0.         1.90194804]
 	 [1.90194804 0.        ]]


# 手撸版
from math import radians, cos, sin, asin, sqrt
# 参数 经度1 纬度1 经度2 纬度2 
def haversine(lon1, lat1, lon2, lat2):
    &quot;&quot;&quot;
    Calculate the great circle distance between two points 
    on the earth (specified in decimal degrees)
    &quot;&quot;&quot;
    # convert decimal degrees to radians 
    lon1, lat1, lon2, lat2 = map(radians, [lon1, lat1, lon2, lat2])

    # haversine formula 
    dlon = lon2 - lon1 
    dlat = lat2 - lat1 
    a = sin(dlat/2)**2 + cos(lat1) * cos(lat2) * sin(dlon/2)**2
    c = 2 * asin(sqrt(a)) 
    r = 6371 # Radius of earth in kilometers. Use 3956 for miles
    return c * r


# 后者乘了地球半径 但是不乘两者计算结果还是有些不同 
</code></pre>
<h3 id="用于字符串的距离">用于字符串的距离</h3>
<h4 id="汉明距离">汉明距离</h4>
<h4 id="编辑距离">编辑距离</h4>
<table>
<thead>
<tr>
<th>metric</th>
<th>名称</th>
<th>定义</th>
</tr>
</thead>
<tbody>
<tr>
<td>“hamming”</td>
<td>汉明距离</td>
<td>两个（相同长度）字对应位不同的数量，即将其中一个变为另外一个所需要作的最小替换次数</td>
</tr>
<tr>
<td>&quot;Levenshtein&quot;</td>
<td>编辑距离</td>
<td>两个字串之间，由一个转成另一个所需的最少编辑操作次数。许可的编辑操作包括将一个字符替换成另一个字符，插入一个字符，删除一个字符。</td>
</tr>
</tbody>
</table>
<pre><code class="language-python">pip install python-Levenshtein

import Levenshtein

# 汉明距离
Levenshtein.hamming(str1, str2)

# 编辑距离
Levenshtein.distance(str1, str2)

# 计算莱文斯坦比_字符串相似度
Levenshtein.ratio(str1, str2)
</code></pre>
<h3 id="用于自定义的距离">用于自定义的距离</h3>
<p>Sklearn中支持自定义距离</p>
<figure data-type="image" tabindex="13"><img src="https://sadjjk.github.io/post-images/20190606153740106.png" alt="image-20190606153740106" loading="lazy"></figure>
<p>按这个格式定义距离，就可以在Sklearn的模型中直接调用</p>
<p>Ps:大学泛函课本里第一课就有写距离定义,非负性、对称性、传递性</p>
<h3 id="参考文献">参考文献：</h3>
<p>sklearn.neighbors.DistanceMetric文档  <a href="https://scikit-learn.org/stable/modules/generated/sklearn.neighbors.DistanceMetric.html#sklearn.neighbors.DistanceMetric">https://scikit-learn.org/stable/modules/generated/sklearn.neighbors.DistanceMetric.html#sklearn.neighbors.DistanceMetric</a></p>
<p>各种距离分析 <a href="https://www.cnblogs.com/sason/p/5590228.html">https://www.cnblogs.com/sason/p/5590228.html</a></p>
<p>标准化欧式距离 <a href="https://blog.csdn.net/jinzhichaoshuiping/article/details/51019473">https://blog.csdn.net/jinzhichaoshuiping/article/details/51019473</a></p>
<p>python-Levenshtein几个计算字串相似度的函数解析  <a href="https://blog.csdn.net/u010454729/article/details/46559845">https://blog.csdn.net/u010454729/article/details/46559845</a></p>
`
    var content = article.split("<!--more-->")[1]
    if (content != null)
        document.getElementById('article').innerHTML = content;
    else
        document.getElementById('article').innerHTML = article

    let navigation = new AutocJs({
        title:'各种常用距离及代码实现',
        isGenerateOutlineChapterCode: false
    })
    </script>
</div>
</body>
</html>

